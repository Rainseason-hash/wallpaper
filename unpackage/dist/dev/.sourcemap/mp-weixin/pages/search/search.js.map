{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n\t<view class=\"searchLayout\">\n\t\t<view class=\"search\">\n\t\t\t<uni-search-bar\n\t\t\t\tclass=\"uni-mt-10\"\n\t\t\t\tv-model=\"queryParams.keyword\"\n\t\t\t\tfocus\n\t\t\t\tradius=\"5\"\n\t\t\t\tplaceholder=\"请输入商品\"\n\t\t\t\tclearButton=\"auto\"\n\t\t\t\tcancelButton=\"always\"\n\t\t\t\t@confirm=\"onSearch\"\n\t\t\t\t@cancel=\"onClear\"\n\t\t\t\t@clear=\"onClear\"\n\t\t\t/>\n\t\t</view>\n\t\t<view v-if=\"!classList.length\">\n\t\t\t<view class=\"history\" v-if=\"historyList.length\">\n\t\t\t\t<view class=\"lastSearch\">\n\t\t\t\t\t<view class=\"text\">最近搜索</view>\n\t\t\t\t\t<view class=\"icon\">\n\t\t\t\t\t\t<uni-icons type=\"trash-filled\" @click=\"removeList\" size=\"26\" color=\"gray\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"searchList\">\n\t\t\t\t\t<view class=\"item\" v-for=\"(item, index) in historyList\" :key=\"item._id\" @click=\"clickTab(item)\">{{ item }}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<view class=\"hot\">\n\t\t\t\t<view class=\"text\">热门搜索</view>\n\t\t\t\t<view class=\"hotList\">\n\t\t\t\t\t<view class=\"item\" v-for=\"(item, index) in 5\" :key=\"index\" @click=\"clickTab(item)\">帅哥</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"noSearch\" v-if=\"noSearch\">\n\t\t\t<uv-empty mode=\"search\"></uv-empty>\n\t\t</view>\n\t\t<view v-else>\n\t\t\t<view class=\"list\">\n\t\t\t\t<navigator :url=\"`/pages/detail/detail?id=${item._id}`\" class=\"item\" v-for=\"item in classList\" :key=\"item._id\">\n\t\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\n\t\t\t\t</navigator>\n\t\t\t</view>\n\t\t\t<view class=\"loadingLayout\" v-if=\"noData || classList.length\"><uni-load-more :status=\"noData ? 'noMore' : 'loading'\" /></view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { onLoad, onUnload, onReachBottom } from '@dcloudio/uni-app';\nimport { apiGetSearchData } from '@/api/apis.js';\n//没有更多\nconst noData = ref(false);\nconst noSearch = ref(false);\n//查询参数\nconst queryParams = ref({\n\tpageNum: 1,\n\tpageSize: 12,\n\tkeyword: '' //搜索关键字\n});\n//历史记录\nconst historyList = ref(uni.getStorageSync('historyList') || []);\n//热门搜索\nconst hotList = ref([]);\n//搜索结果列表\nconst classList = ref([]);\n//回车添加到记录\nconst onSearch = () => {\n\t// console.log(queryParams.value.keyword);\n\tuni.showLoading({\n\t\ttitle: '加载中...'\n\t});\n\t// slice表示记录最多10个\n\thistoryList.value = [...new Set([queryParams.value.keyword, ...historyList.value])].slice(0, 10);\n\tuni.setStorageSync('historyList', historyList.value);\n\tinitParams(queryParams.value.keyword);\n\tgetSearch();\n};\n//点击每一个历史记录\nconst clickTab = (value) => {\n\tinitParams(value);\n\tonSearch();\n};\n//发搜索请求\nconst getSearch = async () => {\n\ttry {\n\t\tconst res = await apiGetSearchData(queryParams.value);\n\t\t// console.log(res);\n\t\tclassList.value = [...classList.value, ...res.data];\n\t\tuni.setStorageSync('classList', classList.value);\n\t\tif (queryParams.value.pageSize > res.data.length) noData.value = true;\n\t\tif (res.data.length == 0 && classList.value.length == 0) noSearch.value = true;\n\t} finally {\n\t\tuni.hideLoading();\n\t}\n};\n//清空历史记录\nconst removeList = () => {\n\tuni.showModal({\n\t\ttitle: '是否清空历史记录',\n\t\tsuccess: (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\tuni.removeStorageSync('historyList');\n\t\t\t\thistoryList.value = [];\n\t\t\t}\n\t\t}\n\t});\n};\nconst initParams = (value = '') => {\n\tclassList.value = [];\n\tnoData.value = false;\n\tnoSearch.value = false;\n\tqueryParams.value = {\n\t\tpageNum: 1,\n\t\tpageSize: 12,\n\t\tkeyword: value || '' //搜索关键字\n\t};\n};\n//搜索框叉号,取消\nconst onClear = () => {\n\tinitParams();\n};\n//触底加载更多\nonReachBottom(() => {\n\tqueryParams.value.pageNum++;\n\n\tgetSearch();\n});\n\n//关闭有页面\nonUnload(() => {\n\tuni.removeStorageSync('classList', classList.value);\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.history {\n\tpadding: 35rpx 30rpx;\n\t.lastSearch {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tfont-size: 32rpx;\n\t\tcolor: #999;\n\n\t\t.text {\n\t\t\tfont-size: 33rpx;\n\t\t\tcolor: #999;\n\t\t}\n\t}\n\t.searchList {\n\t\tmargin: 30rpx 0;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\talign-items: center;\n\t\t.item {\n\t\t\tbackground: rgba(0, 0, 0, 0.05);\n\t\t\tborder-radius: 50rpx;\n\t\t\tpadding: 13rpx 30rpx;\n\t\t\tcolor: black;\n\t\t\ttext-align: center;\n\t\t\tmargin-right: 20rpx;\n\t\t\tmargin-top: 20rpx;\n\t\t\tfont-size: 28rpx;\n\t\t}\n\t}\n}\n.hot {\n\tpadding: 28rpx 30rpx;\n\t.text {\n\t\tfont-size: 33rpx;\n\t\tcolor: #999;\n\t}\n\t.hotList {\n\t\tmargin: 40rpx 0;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\talign-items: center;\n\t\t.item {\n\t\t\tbackground: rgba(0, 0, 0, 0.05);\n\t\t\tborder-radius: 50rpx;\n\t\t\tpadding: 13rpx 30rpx;\n\t\t\tcolor: black;\n\t\t\ttext-align: center;\n\t\t\tmargin-right: 20rpx;\n\t\t\tfont-size: 28rpx;\n\t\t}\n\t}\n}\n.noSearch {\n\tmargin-top: 80rpx;\n}\n.list {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(3, 1fr);\n\tgap: 5rpx;\n\tpadding: 20rpx 5rpx;\n\t.item {\n\t\theight: 440rpx;\n\t\timage {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tdisplay: block;\n\t\t}\n\t}\n}\n</style>\n","import MiniProgramPage from 'D:/program files/HBuilderX.4.76.2025082103/Project/wallPaper/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiGetSearchData","onReachBottom","onUnload"],"mappings":";;;;;;;;;;;;;;;;;;;;AAuDA,UAAM,SAASA,cAAAA,IAAI,KAAK;AACxB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAE1B,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACvB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA;AAAA,IACV,CAAC;AAED,UAAM,cAAcA,cAAG,IAACC,cAAG,MAAC,eAAe,aAAa,KAAK,CAAA,CAAE;AAE/CD,kBAAG,IAAC,EAAE;AAEtB,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AAExB,UAAM,WAAW,MAAM;AAEtBC,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,MACT,CAAE;AAED,kBAAY,QAAQ,CAAC,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,YAAY,KAAK,CAAC,CAAC,EAAE,MAAM,GAAG,EAAE;AAC/FA,oBAAAA,MAAI,eAAe,eAAe,YAAY,KAAK;AACnD,iBAAW,YAAY,MAAM,OAAO;AACpC;IACD;AAEA,UAAM,WAAW,CAAC,UAAU;AAC3B,iBAAW,KAAK;AAChB;IACD;AAEA,UAAM,YAAY,YAAY;AAC7B,UAAI;AACH,cAAM,MAAM,MAAMC,SAAAA,iBAAiB,YAAY,KAAK;AAEpD,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,IAAI;AAClDD,sBAAAA,MAAI,eAAe,aAAa,UAAU,KAAK;AAC/C,YAAI,YAAY,MAAM,WAAW,IAAI,KAAK;AAAQ,iBAAO,QAAQ;AACjE,YAAI,IAAI,KAAK,UAAU,KAAK,UAAU,MAAM,UAAU;AAAG,mBAAS,QAAQ;AAAA,MAC5E,UAAW;AACTA,sBAAG,MAAC,YAAW;AAAA,MACf;AAAA,IACF;AAEA,UAAM,aAAa,MAAM;AACxBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChBA,gCAAI,kBAAkB,aAAa;AACnC,wBAAY,QAAQ;UACpB;AAAA,QACD;AAAA,MACH,CAAE;AAAA,IACF;AACA,UAAM,aAAa,CAAC,QAAQ,OAAO;AAClC,gBAAU,QAAQ;AAClB,aAAO,QAAQ;AACf,eAAS,QAAQ;AACjB,kBAAY,QAAQ;AAAA,QACnB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS,SAAS;AAAA;AAAA,MACpB;AAAA,IACA;AAEA,UAAM,UAAU,MAAM;AACrB;IACD;AAEAE,kBAAAA,cAAc,MAAM;AACnB,kBAAY,MAAM;AAElB;IACD,CAAC;AAGDC,kBAAAA,SAAS,MAAM;AACdH,oBAAAA,MAAI,kBAAkB,aAAa,UAAU,KAAK;AAAA,IACnD,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtID,GAAG,WAAW,eAAe;"}